---

---

<!-- Prevent flash by hiding banner immediately if consent already given -->
<script is:inline>
    // Hide consent banner immediately if consent was already given
    if (localStorage.getItem("adConsentGiven")) {
        document.write("<style>.consent-banner { display: none !important; }</style>");
    }
</script>

<div id="consent-banner" class="consent-banner">
    <div class="consent-content">
        <h3>We use cookies</h3>
        <p>
            This website uses cookies and similar technologies to ensure you get the best experience. We also use
            cookies for ads personalization and measurement. You can adjust your preferences below.
        </p>
        <div class="consent-buttons">
            <button id="accept-all">Accept all</button>
            <button id="reject-all">Reject non-essential</button>
            <button id="customize" class="secondary">Customize</button>
        </div>
    </div>
    <div id="customize-options" class="customize-options hidden">
        <div class="option">
            <input type="checkbox" id="essential" checked disabled />
            <label for="essential">Essential (required)</label>
        </div>
        <div class="option">
            <input type="checkbox" id="analytics" checked />
            <label for="analytics">Analytics</label>
        </div>
        <div class="option">
            <input type="checkbox" id="advertising" checked />
            <label for="advertising">Advertising</label>
        </div>
        <div class="consent-buttons">
            <button id="save-preferences">Save preferences</button>
        </div>
    </div>
</div>

<script is:inline>
    // Cookie consent management
    function initializeConsentBanner() {
        const consentBanner = document.getElementById("consent-banner");
        const customizeOptions = document.getElementById("customize-options");
        const acceptAllBtn = document.getElementById("accept-all");
        const rejectAllBtn = document.getElementById("reject-all");
        const customizeBtn = document.getElementById("customize");
        const savePreferencesBtn = document.getElementById("save-preferences");

        // Show banner if consent not previously given
        if (!localStorage.getItem("adConsentGiven")) {
            consentBanner.classList.add("visible");
        }

        // Customize button toggles options
        customizeBtn.addEventListener("click", () => {
            customizeOptions.classList.toggle("hidden");
        });

        // Accept all button
        acceptAllBtn.addEventListener("click", () => {
            setConsent({
                essential: true,
                analytics: true,
                advertising: true,
            });
            consentBanner.classList.remove("visible");
            enableGoogleAds();
        });

        // Reject all button (except essential)
        rejectAllBtn.addEventListener("click", () => {
            setConsent({
                essential: true,
                analytics: false,
                advertising: false,
            });
            consentBanner.classList.remove("visible");
        });

        // Save preferences button
        savePreferencesBtn.addEventListener("click", () => {
            const analytics = document.getElementById("analytics").checked;
            const advertising = document.getElementById("advertising").checked;

            setConsent({
                essential: true,
                analytics,
                advertising,
            });

            consentBanner.classList.remove("visible");

            if (advertising) {
                enableGoogleAds();
            }
        });

        // Helper function to set consent
        function setConsent(consentOptions) {
            localStorage.setItem("adConsentGiven", "true");
            localStorage.setItem("consentOptions", JSON.stringify(consentOptions));

            // Dispatch consent event for Google
            if (consentOptions.advertising) {
                if (window.dataLayer) {
                    window.dataLayer.push({
                        event: "consent-update",
                        ad_storage: "granted",
                        analytics_storage: consentOptions.analytics ? "granted" : "denied",
                    });
                }
            }
        }

        // Enable Google ads
        function enableGoogleAds() {
            // Load Google AdSense script
            if (!document.querySelector('script[src*="adsbygoogle.js"]')) {
                const adsScript = document.createElement("script");
                adsScript.src =
                    "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7606819328826318";
                adsScript.async = true;
                adsScript.crossOrigin = "anonymous";
                document.head.appendChild(adsScript);
            }

            // Initialize ads
            setTimeout(() => {
                try {
                    if (window.adsbygoogle) {
                        (window.adsbygoogle = window.adsbygoogle || []).push({});
                    }
                } catch (e) {
                    console.error("AdSense error:", e);
                }
            }, 1000);
        }

        // Check if consent was previously given and ads should be enabled
        const consentOptions = JSON.parse(localStorage.getItem("consentOptions") || '{"advertising": false}');
        if (consentOptions.advertising) {
            enableGoogleAds();
        }
    }

    // Initialize on page load
    initializeConsentBanner();

    // Re-initialize after each client-side navigation
    document.addEventListener("astro:page-load", initializeConsentBanner);
</script>

<style>
    .consent-banner {
        display: none;
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: 20px;
        background: var(--color-background);
        color: var(--color-text);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(128, 128, 128, 0.3);
        border-radius: 8px;
        padding: 20px;
        z-index: 9999;
        max-width: 600px;
        margin: 0 auto;
        opacity: 0;
        transform: translateY(20px);
        transition:
            opacity 0.3s ease,
            transform 0.3s ease;
    }

    .consent-banner.visible {
        display: block;
        opacity: 1;
        transform: translateY(0);
    }

    /* Dark theme shadow adjustment */
    :global(.dark) .consent-banner {
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }

    .consent-content h3 {
        margin-top: 0;
        color: var(--color-text);
    }

    .consent-content p {
        color: var(--color-text);
    }

    .consent-buttons {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
    }

    .consent-buttons button {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        transition:
            background 0.2s ease,
            opacity 0.2s ease;
    }

    .consent-buttons button:not(.secondary) {
        background: var(--color-text);
        color: var(--color-background);
        border: 1px solid var(--color-text);
    }

    .consent-buttons button:not(.secondary):hover {
        opacity: 0.8;
    }

    .consent-buttons button.secondary {
        background: transparent;
        color: var(--color-text);
        border: 1px solid rgba(128, 128, 128, 0.5);
    }

    .consent-buttons button.secondary:hover {
        background: rgba(128, 128, 128, 0.1);
    }

    .customize-options {
        margin-top: 15px;
        border-top: 1px solid rgba(128, 128, 128, 0.3);
        padding-top: 15px;
    }

    .customize-options.hidden {
        display: none;
    }

    .option {
        margin-bottom: 8px;
        display: flex;
        align-items: center;
    }

    .option input {
        margin-right: 8px;
    }

    .option label {
        color: var(--color-text);
    }

    /* Responsive design for mobile */
    @media (max-width: 640px) {
        .consent-banner {
            left: 10px;
            right: 10px;
            bottom: 10px;
        }

        .consent-buttons {
            flex-direction: column;
        }

        .consent-buttons button {
            width: 100%;
        }
    }
</style>
